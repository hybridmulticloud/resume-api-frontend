name: Deploy & Verify Frontend

on:
  push:
    branches:
      - main
    paths:
      - public/**
      - .github/workflows/deploy-frontend.yml
  workflow_dispatch: {}

jobs:
  deploy-frontend:
    name: Build & Sync Static Site
    runs-on: ubuntu-latest
    outputs:
      api_url:    ${{ steps.parse.outputs.api_url }}
      cf_dist_id: ${{ steps.parse.outputs.cf_dist_id }}

    env:
      GITHUB_TOKEN:          ${{ secrets.GITHUB_TOKEN }}
      AWS_REGION:            ${{ secrets.AWS_REGION }}
      AWS_ACCESS_KEY_ID:     ${{ secrets.AWS_ACCESS_KEY_ID }}
      AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

    steps:
      - uses: actions/checkout@v3

      - name: Install GitHub CLI, jq, envsubst
        run: |
          sudo apt-get update -y
          sudo apt-get install -y gh jq gettext-base

      - id: get_run
        name: Get last successful backend infra run id
        run: |
          RUN_ID=$(gh run list \
            --repo hybridmulticloud/resume-api-backend \
            --workflow 'Deploy
